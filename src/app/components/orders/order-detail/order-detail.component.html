<!-- Delete confirmation modal-->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Deletion</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this order? This cannot be undone!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" data-dismiss="modal" class="btn btn-danger" (click)="deleteOrder()">Delete</button>
      </div>
    </div>
  </div>
</div>
<!-- Include app-add-item here to avoid conflict with jumbotron classes-->
<app-add-item #addItemComponent [employee]="true" (chosenItem)="setItem($event)"></app-add-item>
<div class="container" *ngIf="(order | async) as currentOrder">
  <div class="jumbotron">
    <h2 class="display-5" *ngIf="loading">...</h2>
    <div class="row" *ngIf="!loading">
      <div class="col-8">
        <h2 class="display-5">Order from {{currentOrder.supplier}}</h2>
        <p class="lead">Created on {{currentOrder.date_created | date: 'MMM d, y, h:mm a'}}</p>
        <p class="lead" *ngIf="currentOrder?.date_submitted"> Ordered on {{currentOrder?.date_submitted | date: 'MMM d, y, h:mm a'}}</p>
        <p class="lead" *ngIf="currentOrder?.date_completed"> Completed on {{currentOrder?.date_completed | date: 'MMM d, y, h:mm a'}}</p>
      </div>
      <div class="col-4">
        <button class="btn btn-danger float-right ml-2" type="button" id="deleteButton" data-toggle="modal" data-target="#confirmDeleteModal">Delete</button>
        <button class="btn btn-md float-right" type="button" id="statusDropdownButton"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
          [ngClass]="{'badge-primary': currentOrder.status == 'In Cart',
                      'badge-success': currentOrder.status == 'Ordered',
                      'badge-secondary': currentOrder.status == 'Completed'}">
          {{currentOrder.status}} <i class="fas fa-caret-down"></i>
        </button>
        <div class="dropdown-menu">
          <h6 class="dropdown-header">Set Status</h6>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" (click)="setStatus('Completed')">Completed</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" (click)="setStatus('Ordered')">Ordered</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" (click)="setStatus('In Cart')">In Cart</a>
        </div>
      </div>
    </div>
  </div>
  <h4 class="display-5">Add Item</h4>
  <form [formGroup]="stagedOrderForm">
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <button class="btn btn-outline-secondary" type="button" (click)="triggerItemSearch()">
          <span *ngIf="!(stagedOrderItem | async)">Select Item</span>
          <span *ngIf="(stagedOrderItem | async) as item">{{item.name}}</span>
        </button>
      </div>
      <input class="form-control" type="text" formControlName="transaction"
             placeholder="Transaction ID">
      <input class="form-control" type="number" placeholder="Quantity" formControlName="quantity">
      <div class="input-group-append">
        <button class="btn btn-success" type="submit"
                [disabled]="!(stagedOrderForm.valid && (stagedOrderItem | async) != null)"
                (click)="submitStagedItem()">Add</button>
      </div>
    </div>
  </form>
  <table class="table table-striped" *ngIf="currentOrder">
    <thead>
    <tr>
      <th scope="col">Item</th>
      <th scope="col">Our Cost</th>
      <th scope="col">Sale Price</th>
      <th scope="col">Stock</th>
      <th scope="col">Transaction</th>
      <th scope="col">Quantity</th>
      <th colspan="2">Actions</th>
    </tr>
    </thead>
    <!-- Items in currentOrder-->
    <tbody>
      <tr *ngFor="let item of currentOrder.items">
        <th scope="row">{{item.item.name}}</th>
        <td>{{item.item.wholesale_cost}}</td>
        <td>{{item.item.standard_price}}</td>
        <td>{{item.item.stock}}</td>
        <td *ngIf="item.transaction">{{item.transaction}}</td>
        <td *ngIf="!item.transaction">None</td>
        <td></td>
        <td><button class="btn btn-outline-danger" (click)="removeItemFromOrder(item.item)">Remove</button></td>
      </tr>
    </tbody>
  </table>
</div>
